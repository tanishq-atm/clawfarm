# 2026-02-04

## Principles
- **Always verify and quick test** - Don't call things done without testing them first

## Leonardo.ai Automation Project ⚠️ ARCHITECTURE COMPLETE, SUCCESS RATE LIMITED
**Goal:** Demo AgentMail + Browser Use for programmatic service access

**What we built:**
- Full end-to-end automation: inbox creation → signup → email verification → API key extraction → service usage
- Zero human intervention from start to finish

**Results:**
- Phase 1: Browser Use signed up account (leonardo-bot-20260204-034244@agentmail.to)
- Phase 2: Retrieved verification code `623535` from AgentMail API
- Phase 3: Browser Use entered code + extracted API key `5cd451b9-798a-472c-a66f-98aaf7cc4622`
- Validation: API key works, account has 150 tokens + 3344 API tokens
- Test: Generated AI image successfully using Leonardo API

**Success Rate Reality:**
- Test run 1 (04:30 UTC): ✅ Success - full automation worked
- Test run 2 (05:09 UTC): ❌ Failed - Browser Use timeout after 2 steps
- Test run 3 (05:42 UTC): ❌ Failed - Cloudflare CAPTCHA blocked signup
- **Actual success rate: 1/3 (33%)** - not the 100% we hoped for

**Root cause:** Cloudflare bot detection blocks Browser Use Cloud's datacenter IPs unpredictably.

**Lessons learned:**
- AgentMail SDK's `messages.get()` needed for full email content (list doesn't include body)
- Leonardo uses verification CODE not link (had to adapt Phase 3)
- Browser Use `create_task()` returns dict with `id` field, not just ID string
- Always test APIs immediately after getting keys (caught working config)

**Key Technical Learnings:**
- Browser Use sessions share **browser state** (cookies, URL) but **NOT agent memory**
- Each task in a session is a fresh AI agent that just sees the current browser
- Task 2 prompts must provide FULL context (email, password) even though Task 1 already did signup
- Profiles are for re-using EXISTING accounts, not creating new ones
- Session continuation works perfectly when CAPTCHAs don't interfere

**Files created:**
- leonardo_automation_state.json (full execution log)
- leonardo_test_generation.json (image generation proof)
- phase3_verify_with_code.py (updated for code instead of link)
